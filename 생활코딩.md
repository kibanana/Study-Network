# HTTP [[Link](https://www.youtube.com/playlist?list=PLuHgQVnccGMBd-v_DjNm61EBaDpYZSV1Z)]

> HyperText Transfer Protocol

Web Browser와 Web Server가 **통신할 때 사용하는 통신 규칙**이다.

HTTP는 처음 등장했을 때에는 매우매우 단순한 통신 규칙이었다. 하지만 웹이 폭발적으로 성장하면서 성능, 보안 측면에서 안전성을 확보하는 게 어려워졌다.

따라서 HTTP는 보다 풍부한 기능을 가진 프로토콜로 발전하기 시작했다. 또한 HTTP는 현대에 이르러서는 텍스트 뿐만 아니라 오디오, 비디오 같은 다양한 멀티미디어 파일들도 전송할 수 있게 됐다.

HTTP는 웹을 넘어서서 **인터넷이 동작하는 근간**이라고 할 수 있다.


## 소개
요청과 응답을 특정한 형식(메시지)를 약속하고 정보를 주고받을 수 있도록 도와주는 프로토콜이다.

사실 HTTP는 굉장히 추상적인 것이다.

Request Message와 Response Message 내의 텍스트 정보로 요청과 응답이 원활하게 이뤄질 수 있도록 한다.


## Request Message `HTTP Request Header`
요청행(Request Line) + 헤더 + 바디

### Request Line
- `GET` : HTTP Method
- `/index.html` : 웹 브라우저가 웹 서버에 요청하는 정보
- `HTTP/1.1` : 웹 브라우저가 현재 사용하고 있는 HTTP 버전

### Header
- `Host` : 인터넷에 연결되어 있는 컴퓨터를 각각 식별하는 이름. 현재 접속한 웹사이트의 웹서버를 의미한다. 하나의 웹서버가 여러 개의 도메인을 서비스할 수 있으므로 `Host`에 적힌 정보에 따라 다른 정보를 보낼 수 있다. (-> 가상 호스트)
- `User-Agent` : 웹 브라우저의 다른 표현
- `Accept-Encoding` : 웹 브라우저가 처리할 수 있는 압축 방법(웹 서버에서 압축, 웹 브라우저에서 압축 풀기)을 명시한다.
- `If-Modified-Since` : 요청할 때마다 웹 서버에 응답받지 않아서 효율성을 높인다.


## Response Message `HTTP Response Header`
응답행(Response Line) + 헤더 + 바디

### Response Line
- `HTTP/1.1` : 웹 브라우저가 현재 사용하고 있는 HTTP 버전
- `200` : 상태코드
- `OK` : 상태코드를 사람이 이해하기 쉽도록 말로 풀어쓴 것


# Doname Name Server [[Link](https://www.youtube.com/playlist?list=PLuHgQVnccGMCI75J-rC8yZSVGZq3gYsFp)]






# Home Server [[Link](https://www.youtube.com/playlist?list=PLuHgQVnccGMA52uRBmSwqcvtI5IMoFclJ)]











# HTTP Cache [[Link](https://www.youtube.com/playlist?list=PLuHgQVnccGMAM6VAWEKtaUnvzePCxnUVo)]

웹이 폭발적으로 성장하면서 전송되는 데이터의 크기가 급격히 늘어난다. 따라서 데이터의 전송 속도를 높이기 위해 여러 방법을 강구한다.

그 중 하나가 바로 **Cache**다.

한 번 요청하고 응답받은 데이터를 저장해두고 다음에 같은 요청을 할 일이 있을 때 저장해둔 데이터를 제공하는 것이다.

따라서 네트워크 지연으로 인한 속도 저하가 발생하지 않는다. 또, 돈을 아낄 수 있다.

하지만 만약 사용자가 캐시를 사용한다면, 사이트 운영자가 사이트를 개편해도 사용자는 캐시에 의해 이전의 내용을 보게될 수 있다.

캐시를 최신 상태로 유지하는 것은 굉장히 어렵다.

**Fresh, Performance**

> Cache는 HTTP 성능을 향상시키고 귀한 인터넷 자원을 절약하기 위한 핵심 기능이다.

![image](https://user-images.githubusercontent.com/37951612/80375735-ba1a8a80-88d3-11ea-8bba-93f06a73c673.png)

↑ 캐시 실습 시에는 위처럼 네트워크 속도 설정을 변경할 수 있다. 캐시 효과를 직접 보기 위해서는 약간 느린 네트워크(`Slow 3G`)를 선택하는 게 좋다.

Apache Configuration 파일(`httpd.conf`) 변경 - 설정을 변경하면 Restart해야 설정이 반영된다.

## `Cache-Control: no store` (HTTP 1.1)

```
# 압축 기능으로 캐시 기능이 혼란이 생기는 것 방지. 실제 운영 시에는 당연히 켜야 한다.
SetEnv no-gzip 1
Header set Cache-Control "no-store"
```

- 캐시를 사용하지 않고 페이지를 띄우려면 **Hard Reload(강력 새로고침, 개발자 도구 연 상태에서만 사용 가능)** 해야한다.
- 또한 `Cache-Control: no-store`를 이용하여 캐시를 저장하지 않도록 했기 때문에 페이지는 매번 요청 및 응답된다.


## `Cache-Control: maxAge`

```
# 1년 캐시
Header set Cache-Control "max-age=31536000"
```

- 캐시가 적용되면서 페이지가 띄워지는 속도가 굉장히 빨라진다.
- 캐시에서 가져온 데이터는 `Size: (from disk cache)`로 확인할 수 있다. -> 아예 네트워크를 사용하지 않은 것이다.
- 사용자 입장에서는 반응성이 좋다는 생각이 들고, 서비스 운영 입장에서도 통신 요금을 절약할 수 있다.

하지만 캐시에서 가장 큰 문제는 **신선도**다.

위처럼 1년짜리 캐시를 적용하면 사용자는 **상한** 캐시만 보게 된다.

```
# 5초 캐시
Header set Cache-Control "max-age=5"
```

근데 5초 캐시를 적용하고 테스트하면 이상한 점이 있다. HTML 코드를 수정하지 않은 상태로 새로고침을 계속하면 소량의 데이터 통신만 해서 신선도를 확인하고, 
실제로 파일을 새로 다운로드받지는 않는다.

이 신선도를 판단하는 기준은 `Last-Modified`, `If-Modified-Since`, `Status Code: 304 Not Modified`가 된다.

```
# 캐시가 유효한지 항상 확인한다
Header set Cache-Control "no-cache"
# 또는
Header set Cache-Control "max-age=0"
```


## `ETag`

`Last-Modifed`를 기준으로 현재 캐시에 있는 정보가 최신인지 아닌지 판단할 수 있다.

하지만 컴퓨터는 굉장히 고속으로 작업을 처리하는 장치이기 때문에 초당 수백에서 수천 개의 작업을 처리할 수 있다. 
그래서 `Last-Modified`에 저장되는 요일, 일, 월, 년도, 시,분,**초** 라는 값은 때에 따라 부정확할 수 있다.

이러한 상황에서 캐시된 데이터의 변경 여부를 정확히 알 수 있는 게 `ETag`다.

`Etag`, `If-None-Match` 값이 서로 같다면 `Status Code: 304 Not Modified`를 반환하며 캐시 값을 사용한다.

이 `Etag`는 웹서버가 고유한 값으로 만들기 때문에 개발자가 신경쓸 필요 없는 영역이다.

만약 Request Header에 `If-Modified-Since`와 `If-None-Match` 둘 다 있다면, 이 두 개가 모두 일치할 때에만 
캐싱된 데이터를 사용한다.


## 캐시 정책
![image](https://user-images.githubusercontent.com/37951612/80398932-5e5ff980-88f3-11ea-8060-4a9855d09399.png)

브라우저의 개발자 도구(Audits)에서 캐시 성능을 테스트하는 기능을 제공한다.

Offline Application, 인터넷이 연결되어 있지 않아도 동작하는 애플리케이션을 오랜 시간 꿈꿔왔다. 
이 때 **Application Cache** 라는 기술을 이용하면 인터넷이 없어도 이미 저장된 캐시 데이터를 이용하여 웹 애플리케이션이 동작하도록 할 수 있다.

**CDN(Content Delivery Network)** 나 **Caching Server** 도 캐시의 일부다. HTTP Cache 강좌에서 본 것들은 브라우저에서 동작하는 캐시를 말한 것이다.
