## VPN(Virtual Private Network)이란?

![image](https://user-images.githubusercontent.com/37951612/78040740-d09ff580-73aa-11ea-991f-8ded58edcc58.png)

분산된 사설망(Private Network)들을 공중망(Public Network)을 이용하여 사설망(Private Network)처럼 사용하는 것이다. 
물리적인 사설망은 보안성이 높지만 거리에 따른 설치와 관리 비용이 크기 때문에 해결책으로 VPN이 등장했다. 
공중망을 이용해도 데이터가 안전하도록 주소 및 라우터 체계 비공개, 데이터 암호화, 인증 및 액세스 권한 제어 등 보안이 강화된다. 

---

인터넷을 이용하여 고비용의 사설망을 대체하는 효과를 얻기 위한 기술이다. 
인터넷망과 같은 공중망을 사용하여 둘 이상의 네트워크를 **안전하게 연결하기 위해 가상의 터널을 만들고, 
암호화된 데이터를 송수신할 수 있도록 구성된 네트워크**다.  
=> VPN은 인터넷을 통해 사설망을 구성할 수 있도록 도와주는 기술

### 사설망(Private Network)과 공중망(Public Network)
**사설망은 **특정한 회사나 조직이 소유하고 독점적으로 사용하는 네트워크**를 의미한다.  
ex) 가정용 공유기 내부에서 사설 IP로 사용하고 있는 네트워크

**공중망**은 사설망과 대칭되는 개념으로, **불특정 다수의 사용자에게 서비스를 제공하는 통신망**이다.  
ex) Internet

### 특징
- 이미 구축되어있는 기존 사설망은 물론, 모바일 환경도 연결 가능하다. 따라서 **추가구축비용이 절감**된다.
- **터널링**과 **암호화**, **인증 기술**을 통해 투명한 통신 서비스를 제공한다.
- **다양한 구축방법, 프로토콜**로 원하는 VPN을 구축할 수 있다.
- **위치와 상관없이 ISP를 통해 접속**하면 **인터넷을 이용**하여 VPN에 접속할 수 있다.

### 단점
- 명확한 표준이 없어서 ISP 업체마다 다른 기술을 사용하기 때문에 서로 다른 ISP 간 연동 시 문제가 발생할 수 있다.
- 성능 저하

## 구성 유형
### L2L (LAN to LAN)
본사와 지사를 연결한다. 쌍방의 VPN 장비를 통해 연결하는 것이다.

### L2C (LAN to Client)
회사가 아닌 곳에서 회사와 연결한다. 각 PC에 있는 VPN Client 프로그램을 이용하여 접속한다.

## VPN 터널링 프로토콜

VPN 연결 지점 간에 오가는 데이터 패킷의 암호화, VPN 터널의 생성 및 관리, 암호화 키 관리를 수행한다.  
**터널링 프로토콜은 데이터가 전송 네트워크를 통과할 수 있도록 하는 라우터 정보를 포함한 헤더, 데이터를 캡슐화한다.  
캡슐화된 프레임은 헤더에 추가되어 있는 라우터 정보를 기반으로 인터넷 같은 공중망을 경유하여 터널의 엔드포인트로 전송된 뒤 
목적지에 도달하면 디캡슐화 되어 최종 목적지로 향한다.**

### 2계층(Data Link Layer) 프로토콜
사용자와 사용자가 접속하고자 하는 네트워크 망을 연결하는 역할을 한다. 
L2C를 위한 client-server-model로 개발되어 remote access VPN에 주로 사용된다.  
Client가 접속할 때 아이디와 암호를 사용하여 인증 절차를 걸치고 터널링을 시작한다.  
`PPP` 기반으로 `ATM(Asynchronous Transfer Model)`, `Frame-Relay`를 지원한다.

- PPTP (Point-to-Point Tunneling Protocol)

  Microsoft가 제안했다.  
  PPP(Point-to-Point) 접속을 확장하여 원격 사용자와 사설망 사이의 보안 접속을 제공하는 Data Link Layer 터널링 프로토콜이다.  
  **인터넷 프로토콜인 TCP/IP를 그대로 이용하면서도 외부인이 접근할 수 없는 별도의 가상사설망을 구축할 수 있도록 해준다.**  
  PPTP를 사용하여 VPN 사용자가 PPP(ex. 다이얼업 방식 인터넷 연결) 방식으로 서버에 접속한 후 인증을 받으면, 
  VPN 터널이 생성되고 이를 통해 VPN 연결이 가능해진다.  
  주로 외부에서 사내 서버에 접속하기 위해 이용되며, Windows, Android 등 다양한 OS에서 기본적으로 제공한다.
  
- L2TP (Layer 2 Tunneling Protocol)

  Microsoft가 제안한 PPTP와 Cisco가 제안한 L2F(Layer 2 Forwarding) 프로토콜을 결합한 것으로, 둘의 장점을 하나로 모으자는 의도로 개발되었다.  
  PPTP와 달리 L2TP는 **IP 네트워크 뿐만 아니라 IP 전송계층이 없는 WAN 구간에서도 사용 가능**하다. 그리고 **ATM, Frame-Relay 등 다양한 네트워크를 지원**한다.  
  
  - `PPTP`는 **IP기반의 네트워크만 지원**하는 반면 `L2TP`는 **패킷 중심의 지점간 연결**이기만 하면 통신이 가능하다.
  - `PPTP`는 **두 지점 사이에 하나의 터널만 가능**하지만 `L2TP`는 **두 지점 사이에 여러개의 터널을 사용**할 수 있으며 터널에 따른 QoS를 적용할 수 있다.
  - `PPTP`와 달리 PPP 데이터 그램을 암호화하지 않으므로 암호화에는 IPsec(IP Security)를 사용하는데 이러한 L2TP와 IPsec의 조합을 `L2TP/IPsec`이라고 한다.

### 3계층(Network) 프로토콜
주로 **L2L VPN**에 이용한다. L2L은 VPN 터널을 이용하여 LAN 단위의 네트워크(본사와 지사) 사이에 사용한다.  
**네트워크 계층 레벨의 VPN**을 구성하며, 우수한 **보안성**을 가지고 있다.

- IPsec (IP Security)  
  IETF IPsec Working Group이 제안했다.  
  **VPN 터널링 업계 표준 프로토콜(Network Layer)**로, 강력한 사용자 인증과 암호화를 제공한다.  
  데이터 송신자 인증을 허용하는 **인증 헤더**(`AH`, 페이로드는 암호화하지 않아 완전한 기밀성을 보장하지는 않으나 Replay Attack을 방지함)와, 
  송신자 인증 및 데이터 암호화를 함께 지원하는 **보안 페이로드 캡슐화**
  (`ESP`, `Encapsulating Security Payload`, Transport Layer의 Segment를 암호화할 경우, 전체 IP 패킷 암호화할 경우 사용) 
  두 종류의 서비스를 제공한다.
  
  보안 게이트웨이 간의 연결 상태에 따라 **터널 모드**와 **전송 모드** 두 가지로 나뉜다.
  
  - 전송(Transport) 모드
  
    - IP Payload만 암호화되고 IP Header는 변하지 않는다(=> Layer 4 이상에서 트래픽 분석 가능)
    - 패킷에 작은 바이트(byte)만 더해진다
    - 공용 네트워크 상에서 패킷의 송신지, 수신지를 식별할 수 있으므로 QoS 등이 가능하다
    - 클라이언트가 패킷에 대한 암호화, 복호화를 수행한다
  
  - 터널(Tunnel) 모드
  
    - IP Header, Payload가 모두 암호화되며 새로운 패킷의 Payload가 된다
    - 라우터가 IPsec 프록시처럼 동작하며 호스트 대신 암호화 수행한다
    - 송신지의 라우터는 패킷을 암호화하고 IPsec을 통해 전달한다
    - 수신지의 라우터는 IPsec을 통해 전달된 패킷을 복호화한다
    - 단말이 IPsec을 수정할 필요 없으며, 트래픽을 분석할 수 없다는 것이 장점이다
  
  
## SSL VPN
SSL 기반의 VPN으로, 장소나 단말 종류와 관계 없이 **웹 브라우저로만 내부 네트워크에 접속할 수 있다.**  
**Application 계층**에서 SSL을 이용한 **암호화 서비스**를 제공한다.

## VPN 모드
- `clientless mode`: 웹 브라우저 사용
- `thin-client mode`: HTTP를 제외한 다른 어플리케이션을 지원한다. `POP3, SMTP, SSH, PORT` Forwarding
- `tunnel mode`: Cisco AnyConnect VPN Client 프로그램을 사용한다

## CPE VPN (Customer Premise Equipment VPN)
CPE 기반 VPN은 **VPN 장비에서 전적으로 터널링이나 암호화 등을 수행하도록 하는 것**이다. 
방화벽에서 VPN 기능을 수용한 장비, 
VPN 전용 게이트웨이, 
라우터에 모듈을 장착해 VPN을 수행하는 것, 
소프트웨어로 VPN 기능을 하는 것 등 다양한 솔루션이 출시되어 있다.  
단순 회선 접속 솔루션이 아니라 보안성을 감당해야 하기 때문에 암호화 강도를 높일수록 비용은 올라가고 성능은 떨어진다. 
따라서 각 장비 업체는 **데이터 압축 등과 같은 기술**을 발전시켜서 **암호화를 수행하더라도 일정 수준의 성능을 유지하도록 하고 있다.**
