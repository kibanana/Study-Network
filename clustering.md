## Clustering(클러스터링) 이란?
**똑같은 구성의 서버들(여러 대의 컴퓨터)을 병렬로 연결한 시스템**으로, 마치 하나의 컴퓨터처럼 사용한다.  
**클러스터링은 Virtual IP 기반으로 구현**되는데, 서비스를 제공하는 실제 장비는 Physical IP를 가지고,
데이터의 처리는 Virtual IP를 통한다.  
=> **추상화**(내부 시스템을 철저하게 가린다)
> 인터넷이 발달하며 엄청 늘어난 서비스 사용량  
⇒ 처리하기 위한 높은 가용성과 확장성(scalability)을 가진 서버가 필요하다  
⇒ 고성능의 병렬컴퓨터나 슈퍼컴퓨터는 매우 고가이기 때문에 쉽게 이용할 수 없다  
⇒ 클러스터링  

### Cluster(클러스터)의 정의
#### 원래 의미
포도송이를 말하며, 집단이나 군집 의미
#### 컴퓨터
여러 대의 컴퓨터들이 연결되어 하나의 시스템처럼 동작하는 컴퓨터들의 집합
#### 전산
- 디스크 클러스터: 하드디스크 상의 섹터를 여러 개 모아서 일정 단위로 묶는 것
- 클러스터링: **독립적으로 수행 가능한 기계(ex. 컴퓨터, CPU)들을 네트워크를 통해 연결**하여 비교적 적은 비용으로 
거대한 규모로 확장을 가능하게 하는 기술
#### 전산 / 전송
몇 개의 연속된 데이터 블록을 묶어 처리 또는 전송하는 단위

### 서버 클러스터 (Server Cluster)
- **각기 다른 서버(Server Enterprise or Server Datacenter)들을 하나로 묶어서 하나의 시스템같이 동작하게 함**으로써, 
**클라이언트들에게 고가용성의 서비스를 제공**하는 것을 말한다
- 클러스터로 묶인 한 시스템에 장애가 발생하면, 정보의 제공 포인트는 클러스터로 묶인 다른 정상적인 서버로 이동한다. 
서버클러스터는 사용자로 하여금 서버 기반 정보를 지속적이고, 끊기지 않게 제공받을 수 있게 한다
- 클러스터는 높은 수준의 가용성, 안정성, 확장성을 제공하기 위해 하나의 시스템을 이용하는 것보다 두개 또는 그 이상의 시스템을 이용한다

### Active-Standby 구조
HA(High Availability) 클러스터링 구축 방법 중 가장 대표적인 것 중 하나
=> 중단 없는 서비스 공급이 가장 큰 이슈
- 구성이 쉽고, 관리자 입장에서 운영도 쉽다
- 운영 서버, 활성 서버, 대기 서버로 구성
- 한 서버가 활성 상태로 서비스중일 때, 대기 서버는 전원이 켜져 있고, OS까지만 올라와 있는 상태다.
#### 동작 방식
1. 활성 서버에 (하드웨어, 네트워크, 프로세스)장애 등이 발생해 서비스 제공 불가 상태
2. 대기 서버에 있는 HA가 운영 서버의 장애 발생을 감지
3. HA가 자동으로 대기 서버에 모든 서비스를 올린다(⇒ **단방향 페일오버**를 구현하는 구성)
4. 기존 활성 서버에 접속했던 클라이언트는 접속이 끊어지겠지만, **재접속 시 바로 서비스를 받을 수 있다**

## 클러스터 (Cluster)
컴퓨팅 파워를 증가시키기 위한 방법. 여러 대의 일반 워크스테이션을 **네트워크로 연결**하여 하나의 PC처럼 작동하게 하는 기술을 말한다.

(워크스테이션의 CPU 성능이 좋아지고, 네트워크 속도 또한 발달하여 클러스터의 실적용이 가능해졌다  
⇒ 네트워크로 연결된 시스템 내의 컴퓨터들이 하나의 컴퓨터인 것처럼 동작해야 하기 때문에)

클러스터 PC들의 OS는 오픈소스로 인해 자유롭게 튜닝이 가능한 리눅스

### 과학 계산 클러스터
대규모 연산을 하기 위한 클러스터

기상 예측, 핵 관련 등의 과학분야에서 사용. 최근에는 3D 작업도

- 각각의 시스템들의 하드디스크에 운영체제를 각자 설치하여 **시스템에 필요한 파일등을 자체적으로 해결**하는 방식
- 메인 서버 한 대에만 하드디스크가 존재하여 다른 시스템들은 **메인 서버의 파일 시스템을 사용**하는 **Disk-Less 클러스터 방식**

### 부하 분산 클러스터
Load Balancer를 통해 각 장비에 걸리는 부하(작업, 처리)를 시스템 성능이 허용할 수 있게 분산시키는 것이다. 
웹서버와 같이 불특정 다수를 대상으로 높은 가용성을 제공하기 위해 사용

### 네트워크 구성에 따른 부하 분산 클러스터
- **Server** 측면 부하 분산 방식  
    Load Balancer를 앞 단에 두고 Real Server들에게 작업을 분산

- **Client** 측면 부하 분산 방식  
    Client에 부하분산 모듈을 넣어서 Client가 직접 서버의 상황을 확인하고 직접 분산

#### 종류
- **NAT**(Network Address Translation, 주소 변환) 부하 분산 방식

    사설 IP를 사용하는 내부망에서 인터넷망으로 접근하기 위해 네트워크 주소 변환이 필요한데, 이러한 기능이 NAT이다.

    ⇒ NAT을 이용하여 공인 IP로 들어오는 사용자의 요청 패킷을 LVS(Linux Virtual Server)가 ip, port를 확인 후 네트워크 주소 부분을 사설 IP로 변환하여 작업 서버로 전달하는 것. 작업 서버는 처리한 내용을 LVS에게 전달. LVS는 사설 IP로 된 패킷을 공인 IP로 변환 후 요청한 사용자에게 보낸다

- **DR**(Direct Routing) 부하 분산 방식

    NAT 부하 분산 방식과 마찬가지로 LVS가 사용자 요청 패킷을 확인 후 작업 서버로 전달한다.

    ⇒ LVS와 작업 서버들이 동일한 가상 IP를 공유하여 사용자가 직접 작업 서버로 보내는 것처럼 보인다

    ⇒ MAC 주소만을 변경하기 때문에 같은 네트워크 망에서만 동작이 가능

    ⇒ ARP(Address Resolution Protocol, 주소 결정 프로토콜) caching이 남으면 사용자가 처음 연결된 작업 서버와만 통신을 하게 되기 때문에 LVS는 처리량을 제대로 알 수 없고, 부하 분산이 제대로 안된다

- **IP Tunneling** 부하 분산 방식

    datagram 내에 다른 ip 정보를 캡슐화하는 기술

    LVS의 가상 IP주소로 들어온 캡슐화된 패킷을 풀어서 작업 서버로 전달하면, 작업 서버는 처리 후 직접 전송하는 방식

    ⇒ **(IP정보는 이미 정해져 있기 때문에) 물리적 영향을 받지 않고 작업을 분산**할 수 있기 때문에 클러스터로 구성된 서버들이 같은 네트워크 망이 아닌, **다른 네트워크 망에 떨어져 있어도 가능**하다

    ⇒ 확장성이 엄청나지만 서버 OS가 IP Tunneling protocol을 지원해야 함

    ![clustering](https://user-images.githubusercontent.com/37951612/77851318-77518e00-7213-11ea-8241-fc83d2f7c690.png)
    
### 작업 할당 방식에 따른 부하 분산 클러스터
1. Round-Robin 라운드 로빈

    요청의 특성, 각 서버의 성능 등은 전혀 고려하지 않고 무조건 **순서대로 작업 할당**

2. Weighted Round-Robin 가중치 기반 라운드 로빈

    작업 서버 별로 가중치를 두어 **성능이 좋은 서버에 더 많은 처리량** 할당

    3 가중치의 서버와 5가중치의 서버가 있다면 3-5-3-5-3-5-5-5 순서가 된다(서버마다 할당된 가중치만큼 수행 후 다시 시작)

    모든 가중치를 같게 설정한다면 라운드 로빈 방식과 동일하게 동작

3. Least-Connection 최소 접속

    처리 요청이 들어오면 각 **작업 서버들에게 접속되어있는 숫자를 확인**하고 **접속이 적은 작업 서버로 요청을 연결**

4. Weighted Least-Connection 가중치 기반 최소 접속

    작업 서버 별로 가중치를 두어 **성능이 좋은 서버에 더 많은 처리량** 할당
    
    
